# /nxs.tasks

Decompose a High-Level Design into implementable GitHub issues with detailed Low-Level Design for each task.

## Purpose

Breaks down an HLD into sized, sequenced implementation tasks. Each task gets its own LLD generated by the `nxs-architect` agent. Includes automatic consistency analysis and GitHub issue creation.

## When to Use

- After creating HLD with `/nxs.hld`
- When ready to convert design into backlog
- Before starting implementation

## Prerequisites

**Required Files**:
- `HLD.md` (from `/nxs.hld`)
- `epic.md` (in same directory)
- `docs/system/delivery/task-template.md` (task structure)
- `docs/system/delivery/task-labels.md` (valid labels)

**GitHub Setup**:
- `gh` CLI authenticated
- Repository configured in `docs/system/delivery/config.json`

## Usage

### Option 1: With Open HLD File
```bash
# Open HLD.md in IDE, then run:
/nxs.tasks
```

### Option 2: With File Path
```bash
/nxs.tasks docs/product/features/03-space-scoped-tags/HLD.md
```

## What It Does

### Phase 1: Create Epic Issue

Before task decomposition, creates a GitHub issue for the parent epic:

1. Locates `epic.md` in same directory as HLD
2. Runs `nxs-gh-create-epic` skill
3. Updates `epic.md` frontmatter with `link: "#42"`
4. Stores issue number for task parent reference

### Phase 2: Load & Analyze HLD

Reads HLD and extracts:
- System components
- Data models
- API contracts
- Integration points
- Non-functional requirements
- Technology constraints

### Phase 3: Decompose into Tasks

Applies decomposition rules:

**Size Constraint**: â‰¤2 days per task

**Consistency Rule**: After each task, system must be in valid state (tests pass, build succeeds, no broken features)

**Task Categories**:
1. Infrastructure/Setup
2. Data Layer
3. Core Logic
4. API/Interface
5. Integration
6. Polish

### Phase 4: Generate Low-Level Design (Per Task)

For each task, invokes `nxs-architect` agent to create detailed LLD:

**Architect generates**:
- Files to create/modify (exact paths)
- Interfaces/types (TypeScript signatures)
- Key technical decisions with rationale
- Implementation patterns from standards
- Task-specific risks and edge cases
- Alignment with HLD architecture

**LLD structure**:
```markdown
### Files
- `src/services/TagService.ts` - Core tag CRUD logic
- `src/repositories/TagRepository.ts` - Database operations
- `tests/services/TagService.test.ts` - Unit tests

### Interfaces/Types
```typescript
interface CreateTagDTO {
    spaceId: string;
    name: string;
    color: string;
}
```

### Key Decisions
| Decision | Rationale | Alternatives |
|----------|-----------|--------------|
| Use repository pattern | Separates data access from business logic | Direct DB calls (rejected - tight coupling) |

### Implementation Notes
- Validate tag name uniqueness within space
- Enforce 50-tag limit via database constraint
- Use optimistic locking for concurrent updates
```

**Fallback**: If architect fails, generates minimal LLD with manual review flag.

### Phase 5: Auto-Remediation

Automatically fixes common issues:

**Auto-Fixed**:
- Superfluous tasks (barrel files, verification-only)
- Effort <1 hour (merged into related tasks)
- Terminology drift (normalizes to HLD canonical terms)
- Task numbering gaps (renumbers after merges)

**Manual Review Required**:
- Circular dependencies
- Conflicting implementations
- Coverage gaps (user stories without tasks)
- Scope drift between epic/HLD/tasks

### Phase 6: Consistency Analysis

Auto-runs `/nxs.analyze` to validate:
- Epic â†” Task coverage (all stories have tasks)
- HLD â†” Task coverage (all components have tasks)
- Task â†” Task logic (no circular dependencies)
- HLD â†” Task alignment (files match architecture)

**Output**: `task-review.md` with findings classified by severity and remediation type.

### Phase 7: Review Checkpoint

Presents task summary with analysis results:

```
ðŸ”„ CHECKPOINT: Task Review

Generated 5 implementation tasks:

TASK-42.01: Create tags database schema (2h) [database]
TASK-42.02: Implement Tag model and repository (4h) [backend, data-layer]
TASK-42.03: Create tag CRUD API endpoints (6h) [backend, api]
TASK-42.04: Build TagManager UI component (8h) [frontend]
TASK-42.05: Add tag filtering to content views (4h) [frontend, integration]

Analysis: 0 critical, 0 high, 2 medium issues
See tasks/task-review.md for details.

Options:
- continue - Create GitHub issues for all tasks
- skip 03, 05 - Create issues excluding specified tasks
- abort - Cancel to address findings

Your choice?
```

**MANDATORY STOP**: Waits for user confirmation.

### Phase 8: Create GitHub Issues

When user chooses `continue`:

1. Uses `nxs-gh-create-task` skill to bulk-create issues
2. Sets labels from task frontmatter
3. Links to epic issue as parent
4. Adds HLD reference

**Output**:
```
âœ… Created 5 GitHub issues:

#43: TASK-42.01: Create tags database schema
#44: TASK-42.02: Implement Tag model and repository
#45: TASK-42.03: Create tag CRUD API endpoints
#46: TASK-42.04: Build TagManager UI component
#47: TASK-42.05: Add tag filtering to content views

Tasks ready for implementation with /nxs.dev
```

## Task File Structure

Generated files follow template from `docs/system/delivery/task-template.md`:

```markdown
---
title: "TASK-42.01: Create tags database schema"
labels: [database, migration]
parent: "#42"
project: "User Tagging System"
---

## Summary
Create PostgreSQL schema for tags with space-scoped unique constraints.

## Dependencies
- Blocked by: None
- Blocks: TASK-42.02

## Git Workspace
- Worktree: `../nexus-worktrees/42`
- Branch: `feat/42-space-scoped-tags`

## Low-Level Design

### Files
- `migrations/20260123_create_tags.sql` - Tag table migration
- `migrations/20260123_create_content_tags.sql` - Junction table

### Interfaces/Types
```typescript
// N/A for migration task
```

### Key Decisions
| Decision | Rationale | Alternatives |
|----------|-----------|--------------|
| UUID for IDs | Distributed generation, no collisions | Auto-increment (rejected - migration issues) |
| UNIQUE constraint on (space_id, name) | Enforces business rule at DB level | App-level validation (rejected - race conditions) |

### Implementation Notes
- Use UUID v4 for tag IDs
- Add composite index on (space_id, name) for uniqueness and performance
- Foreign keys with CASCADE delete for referential integrity
- Add created_at/updated_at timestamps

## Acceptance Criteria
- [ ] tags table created with all columns
- [ ] content_tags junction table created
- [ ] Unique constraint prevents duplicate tag names per space
- [ ] Foreign keys enforce referential integrity
- [ ] Migration runs successfully on clean database
- [ ] All existing tests pass
- [ ] Migration includes rollback script

## Estimated Effort
2 hours
```

## Example Invocation

```bash
# Open HLD
code docs/product/features/03-space-scoped-tags/HLD.md

# Run command
/nxs.tasks
```

**Output**:
```
âœ“ Located HLD: docs/product/features/03-space-scoped-tags/HLD.md
âœ“ Located epic: docs/product/features/03-space-scoped-tags/epic.md

Creating epic GitHub issue...
âœ“ Created epic issue #42
âœ“ Updated epic.md with link

Reading HLD...
âœ“ Extracted 5 components, 3 data models, 8 API endpoints

Decomposing into tasks...
âœ“ Identified 7 tasks across 4 phases

Generating Low-Level Design for each task...
[1/7] Invoking nxs-architect for TASK-42.01: Create tags database schema...
[2/7] Invoking nxs-architect for TASK-42.02: Implement Tag model...
...
âœ“ LLD generation complete

Auto-remediating...
âœ“ Merged TASK-42.06 (barrel file) into TASK-42.02
âœ“ Normalized "tagId" â†’ "tagId" across all tasks
âœ“ Renumbered tasks: 7 â†’ 5

Running consistency analysis...
âœ“ Epic coverage: 100% (all stories mapped)
âœ“ HLD coverage: 95% (1 minor gap)
âœ“ Task dependencies: Valid (no cycles)

Generated 5 tasks
Auto-remediated: 2 issues
Manual review: 2 medium priority

[Review checkpoint shown]
```

## Output Artifacts

**Created**:
- `tasks/` folder
- `tasks/TASK-{EPIC}.{NN}.md` (one per task)
- `tasks/task-review.md` (analysis report)
- GitHub issues (if confirmed)

**Updated**:
- `epic.md` frontmatter (adds `link` field)

## Common Issues

### HLD Not Found

**Problem**: "Cannot locate HLD file"

**Solutions**:
1. Open HLD.md in IDE
2. Provide path: `/nxs.tasks path/to/HLD.md`
3. Ensure HLD exists in epic directory

### No Valid Labels

**Problem**: "task-labels.md not found"

**Solutions**:
1. Run `/nxs.init` to create structure
2. Create `docs/system/delivery/task-labels.md`
3. Populate with valid labels for your project

### Epic Issue Creation Failed

**Problem**: GitHub CLI error

**Solutions**:
1. Verify `gh auth status`
2. Check repository permissions
3. Ensure `config.json` has correct org/repo

### Critical Issues in Review

**Problem**: "â›” CRITICAL ISSUES FOUND"

**Solutions**:
1. Read `tasks/task-review.md` for details
2. Fix critical issues (circular dependencies, conflicts)
3. Re-run `/nxs.tasks` after fixes

## Review Checkpoint Options

### `continue`
Create GitHub issues for all tasks.

### `skip 03, 05`
Create issues excluding specified task numbers. Useful if you want to manually revise certain tasks first.

### `abort`
Cancel issue creation. Allows manual task file editing. Re-run `/nxs.tasks` or `/nxs.analyze` after changes.

## Next Steps

After task generation:

1. **Review task files**: Validate LLD makes sense
2. **Check task-review.md**: Address medium/low priority issues
3. **Start implementation**: Use `/nxs.dev <issue-number>` on first unblocked task

## Tips

**Read the Template**: The command uses your custom `task-template.md`. Review it to understand generated structure.

**Trust Auto-Remediation**: Superfluous task detection is conservative. Review `task-review.md` to understand what was merged.

**Fix Critical Issues**: Don't skip critical findings. They indicate fundamental problems (circular dependencies, conflicts).

**Sequential Implementation**: Implement tasks in number order. Dependencies are pre-calculated.

**Git Workspace Pre-Configured**: Each task has worktree path and branch name. `/nxs.dev` uses these automatically.

## Related Commands

- [/nxs.hld](nxs-hld.md) - Generate HLD (run first)
- [/nxs.dev](nxs-dev.md) - Implement task (run after)
- [/nxs.analyze](nxs-analyze.md) - Re-validate consistency

## Related Concepts

- [Task Decomposition](../concepts/task-decomposition.md) - Sizing and sequencing principles
- [Agents](../reference/agents.md) - nxs-architect role in LLD generation
